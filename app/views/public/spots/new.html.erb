<div class = "container">
  <h3>おすすめスポットを投稿する</h3>
  <div class = "row">
    <div class = "col">
      <%= form_with model: @spot, url: public_spots_path, local: true do |f| %>
      <%= f.label "名前" %>
      <%= f.text_field :name %><br />

      <%= f.collection_check_boxes(:tag_ids, Tag.all, :id, :name) do |tag| %>
        <div class='form-check'>
          <%= tag.label class: 'form-check-label' do %>
            <%= tag.check_box class: 'form-check-input' %>
            <%= tag.text %>
          <% end %>
        </div>
      <% end %>
      <%= form_with model: @spot, url: public_spots_path, local: true do |f| %>
        <%= f.text_field :tag_ids, class: "form-control", id:'tag_ids',\
            placeholder: "タグをつける。複数つけるには','で区切ってください。" %>
        <% end %>
      <%= f.label "画像" %>
      <%= f.file_field :image, accept: "image/*" %><br />

      <%= f.label "場所" %>
      <%= f.text_field :address %><br />

      <%= f.submit "投稿する" %>
      <% end %>
    </div>
    <div class = "col">
      <%= form_with url: public_map_request_path, method: :get, local: false do |f|%>
        <%= f.hidden_field :address %>
        <%= f.submit '地図表示で確認してみる', :onclick => "return copyAddress()" %>
      <% end %>
      <br />
      <div id='map'></div>
      <style>
      #map{
        height: 400px;
      }
      </style>
    </div>
  </div>

<script>
let mapInstance
function initMap(){
  mapInstance = new google.maps.Map(document.getElementById('map'), {
  center: {lat: -34.397, lng: 150.644},
  zoom: 8
  });
}

function copyAddress() {
  let target_address = $("#spot_address").val();
  $("#address").val(target_address);
  return true;
}
</script>
<script src ="https://maps.googleapis.com/maps/api/js?key=<%= ENV['SECRET_KEY'] %>&callback=initMap" async defer></script>
